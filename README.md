# Schema2Rest (S2R)

This project takes a Mermaid schema with enhancements and builds a ReST server for each entity.  Validation logic is autogenerated.

The data is stored in a Mongo database

## Steps
1. clone the S2R repo
2. copy the S2R Makefile to a new project directory
3. edit the Makefile and set S2R_DIR to the cloned repo location
4. create a mmd file
5. execute "make firsttime" on first run
6. execute "make all" on changes to the schema

## Environment
1. Assumes mongo is installed
2. Uses config.json to define the mongo config and server URL

## MMD Enhancements (uses mmd comments)
1. Allows a "BaseEntity" that all entities include (e.g. - id, updatedAt)
2. Supports auto generation of files (e.g. - id)
3. Supports extensive validation logic
4. Supports unique field contraints
5. Automatically updates unique indexes for contraints (deletes unused and creates new) 


## MMD Snippet
erDiagram
    BaseEntity {
        ObjectId _id
        ISODate createdAt
        ISODate updatedAt
    }
    %% @validation BaseEntity
    %% _id { type ObjectId, required true, autoGenerate true }
    %% createdAt { type ISODate, required true, autoGenerate true }
    %% updatedAt { type ISODate, required true, autoUpdate true }

    Account {
        ISODate expiredAt
    }
    %% @inherits BaseEntity
    %% @validation Account
    %% expiredAt: { type: ISODate, required: false }

    User {
        ObjectId accountId
        String username
        String email
        String password
        String firstName
        String lastName
        String gender
        Boolean isAccountOwner
    }
    %% @inherits BaseEntity
    %% @validation User
    %% @unique username ### Note specified combined field indexes by "username + email"
    %% accountId: { type: ObjectId, required: true }
    %% username: { type: String, required: true, minLength: 3, maxLength: 50 }
    %% email { type String, required true, minLength 8, maxLength 50, pattern ^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$ }
    %% password: { type: String, required: true, minLength: 8 }
    %% firstName: { type: String, required: true, maxLength: 100 }
    %% lastName: { type: String, required: true, maxLength: 100 }
    %% gender { type String, required false, enum [male, female, other] }
    %% isAccountOwner: { type: Boolean, required: true }

#### Other validations
    %% name: { type: String, required: true, maxLength: 100 }
    %% preferences: { type: JSON, required: false }
    %% radiusMiles: { type: Integer, required: false, min: 0 }
    %% tag: { type: String, required: true, maxLength: 50 }
    %% affinity: { type: Integer, required: true, min: -100, max: 100 }
    %% url: { type: String, required: true, pattern: ^https?://[^\s]+$ }
    %% title: { type: String, required: true, maxLength: 200 }
    %% location: { type: String, required: false, maxLength: 200 }
    %% cost: { type: Number, required: false, min: 0 }
    %% recurrence: { type: String, required: false, enum: [daily, weekly, monthly, yearly] }
